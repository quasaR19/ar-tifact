# Руководство по тестированию медиа-плееров DetailsScreen

## Обзор

Этот документ содержит рекомендации по тестированию новых медиа-плееров в DetailsScreen.

## Компоненты для тестирования

### 1. GLBViewerController
- **Расположение**: `OrbitCameraController.cs`, `GLBViewerController.cs`
- **Функциональность**: Просмотр 3D моделей с управлением камерой

### 2. VideoPlayerController
- **Расположение**: `VideoPlayerController.cs`
- **Функциональность**: Воспроизведение локальных видеофайлов

### 3. YouTubePlayerController
- **Расположение**: `YouTubePlayerController.cs`
- **Функциональность**: Отображение и открытие YouTube видео

## Тестовые сценарии

### GLB Viewer

#### Базовая функциональность
- [ ] Загрузка GLB модели из кэша
- [ ] Загрузка GLB модели с сервера (первый запуск)
- [ ] Отображение индикатора загрузки
- [ ] Обработка ошибок загрузки (неверный путь, поврежденный файл)

#### Управление камерой
- [ ] Вращение камеры при drag (touch/mouse)
- [ ] Масштабирование при pinch-to-zoom (мобильные) или колесе мыши (ПК)
- [ ] Кнопка "Сброс камеры" возвращает в начальную позицию
- [ ] Кнопка "Центрировать" центрирует модель
- [ ] Автоматическое центрирование при загрузке модели

#### Производительность
- [ ] FPS > 30 при вращении модели
- [ ] Отсутствие утечек памяти при переключении между артефактами
- [ ] RenderTexture корректно освобождается при закрытии экрана

### Video Player

#### Базовая функциональность
- [ ] Загрузка видео из кэша
- [ ] Загрузка видео с сервера
- [ ] Воспроизведение видео
- [ ] Пауза видео
- [ ] Остановка видео при закрытии экрана

#### Элементы управления
- [ ] Кнопка Play/Pause работает корректно
- [ ] Прогресс-бар показывает текущую позицию воспроизведения
- [ ] Scrubbing (перемотка) работает при перемещении слайдера
- [ ] Отображение времени (текущее/общее) обновляется
- [ ] Клик по видео паузит/возобновляет воспроизведение

#### Обработка ошибок
- [ ] Некорректный путь к файлу
- [ ] Неподдерживаемый формат видео
- [ ] Поврежденный файл

#### Производительность
- [ ] Видео воспроизводится плавно (без задержек)
- [ ] RenderTexture освобождается при закрытии экрана
- [ ] Отсутствие утечек памяти

### YouTube Player

#### Базовая функциональность
- [ ] Парсинг различных форматов YouTube URL:
  - `https://www.youtube.com/watch?v=VIDEO_ID`
  - `https://youtu.be/VIDEO_ID`
  - `https://www.youtube.com/embed/VIDEO_ID`
- [ ] Загрузка thumbnail из YouTube
- [ ] Отображение превью видео
- [ ] Клик по кнопке Play открывает видео в браузере

#### Обработка ошибок
- [ ] Неверный YouTube URL
- [ ] Несуществующий video ID
- [ ] Ошибка загрузки thumbnail

### Интеграция в DetailsScreen

#### Определение типов медиа
- [ ] Корректное определение типа "3d_model" → GLB Viewer
- [ ] Корректное определение типа "video" → Video Player
- [ ] Корректное определение типа "youtube" → YouTube Player
- [ ] Обработка неизвестных типов медиа

#### Переключение между артефактами
- [ ] Очистка предыдущих плееров при загрузке нового артефакта
- [ ] Освобождение ресурсов (RenderTexture, GameObject)
- [ ] Отсутствие утечек памяти

#### Множественные медиа
- [ ] Отображение нескольких медиа одного типа
- [ ] Отображение медиа разных типов в одном артефакте
- [ ] Прокрутка списка медиа

## Тестовые данные

### Пример структуры ArtifactRecord с разными типами медиа

```json
{
  "artifactId": "test-artifact-1",
  "name": "Тестовый артефакт",
  "description": "Артефакт для тестирования медиа-плееров",
  "media": [
    {
      "mediaId": "model-1",
      "mediaType": "3d_model",
      "remoteUrl": "https://example.com/model.glb",
      "localPath": "/path/to/local/model.glb",
      "metadataJson": "{\"centerModel\": true}"
    },
    {
      "mediaId": "video-1",
      "mediaType": "video",
      "remoteUrl": "https://example.com/video.mp4",
      "localPath": "/path/to/local/video.mp4",
      "metadataJson": ""
    },
    {
      "mediaId": "youtube-1",
      "mediaType": "youtube",
      "remoteUrl": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
      "metadataJson": ""
    }
  ]
}
```

## Платформы для тестирования

### Android
- [ ] Сенсорное управление (touch gestures)
- [ ] Pinch-to-zoom для GLB модели
- [ ] Воспроизведение видео (различные форматы: MP4, WebM)
- [ ] Открытие YouTube в браузере

### iOS (если планируется поддержка)
- [ ] Те же тесты, что и для Android

### Editor (Unity Editor)
- [ ] Управление мышью для GLB модели
- [ ] Колесо мыши для масштабирования
- [ ] Воспроизведение видео

## Известные ограничения

### GLB Viewer
- Большие модели (>50 MB) могут загружаться медленно
- Сложные модели могут снижать FPS на слабых устройствах

### Video Player
- Зависит от кодеков устройства
- Некоторые форматы могут не воспроизводиться на определенных платформах

### YouTube Player
- Требует интернет-соединения для загрузки thumbnail
- Открывает видео в браузере (выход из приложения)

## Чеклист финального тестирования

- [ ] Все компоненты скомпилированы без ошибок
- [ ] Нет warning'ов компилятора
- [ ] Базовая функциональность работает для всех типов медиа
- [ ] UI отзывчивый и плавный
- [ ] Нет утечек памяти (проверить через Profiler)
- [ ] Корректная обработка ошибок
- [ ] Состояния загрузки отображаются корректно
- [ ] Документация актуальна

## Инструменты для тестирования

### Unity Profiler
- Проверка использования памяти
- Проверка FPS
- Поиск утечек памяти

### Logcat (Android)
- Проверка логов
- Отладка ошибок

### Unity Console
- Проверка Debug.Log сообщений
- Мониторинг ошибок

## Рекомендации по оптимизации

### Если FPS < 30 при просмотре GLB модели:
1. Снизить разрешение RenderTexture (например, до 512x512)
2. Отключить сглаживание (antiAliasing)
3. Упростить освещение (убрать тени)

### Если видео тормозит:
1. Снизить разрешение RenderTexture
2. Проверить формат видео (предпочтительно MP4 H.264)
3. Уменьшить битрейт видео

### Если возникают утечки памяти:
1. Проверить, что все RenderTexture освобождаются в методе Cleanup
2. Проверить, что все GameObject уничтожаются
3. Проверить, что все Texture2D освобождаются
4. Использовать Unity Profiler для поиска утечек

## Следующие шаги

1. Запустить приложение в Unity Editor
2. Открыть DetailsScreen с тестовыми данными
3. Пройти все тестовые сценарии
4. Собрать билд для Android
5. Протестировать на реальном устройстве
6. Исправить найденные баги
7. Оптимизировать производительность
8. Обновить документацию

## Дополнительные материалы

- [Unity VideoPlayer Documentation](https://docs.unity3d.com/Manual/class-VideoPlayer.html)
- [Unity UI Toolkit Documentation](https://docs.unity3d.com/Manual/UIElements.html)
- [UnityGLTF GitHub](https://github.com/KhronosGroup/UnityGLTF)

